<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#0066FF">
    <title>Fluxio</title>
    
    <style>
        /* RESET & VARIABLES */
        :root {
            --primary: #0066FF;
            --primary-light: #3385FF;
            --primary-dark: #0052CC;
            --primary-gradient: linear-gradient(135deg, var(--primary), var(--primary-light));
            --success: #00C853;
            --error: #FF4444;
            --warning: #FFAA00;
            --bg: #000000;
            --bg-elevated: #111111;
            --bg-high: #1A1A1A;
            --bg-highest: #242424;
            --border: #333333;
            --border-light: #404040;
            --text: #FFFFFF;
            --text-secondary: #AAAAAA;
            --text-tertiary: #666666;
            --safe-top: env(safe-area-inset-top, 0px);
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        html, body {
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* UTILITIES */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .flex-1 { flex: 1; }
        .items-center { align-items: center; }
        .justify-center { justify-content: center; }
        .text-center { text-align: center; }
        .fullscreen { position: fixed; inset: 0; }

        /* LOADING */
        #loading {
            position: fixed;
            inset: 0;
            background: var(--primary-gradient);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: fadeOut 0.5s 1.5s ease forwards;
        }

        .loader {
            width: 60px;
            height: 60px;
            border: 3px solid rgba(255,255,255,0.2);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        /* AUTH SCREEN */
        #auth {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: none;
            padding: 20px;
        }

        .auth-container {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 40px;
        }

        .app-brand {
            text-align: center;
        }

        .logo {
            font-size: 60px;
            margin-bottom: 16px;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: inline-block;
        }

        .app-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 8px;
            letter-spacing: -1px;
        }

        .app-subtitle {
            font-size: 16px;
            color: var(--text-secondary);
        }

        .auth-tabs {
            display: flex;
            background: var(--bg-high);
            border-radius: 12px;
            padding: 4px;
        }

        .tab {
            flex: 1;
            padding: 14px;
            border: none;
            background: none;
            color: var(--text-secondary);
            font-size: 16px;
            font-weight: 600;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .tab.active {
            background: var(--primary);
            color: white;
            box-shadow: 0 4px 20px rgba(0, 102, 255, 0.3);
        }

        .form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .input {
            width: 100%;
            height: 56px;
            padding: 0 20px;
            background: var(--bg-high);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .btn {
            width: 100%;
            height: 56px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .btn:active {
            opacity: 0.9;
            transform: scale(0.98);
        }

        /* MAIN APP */
        #app {
            position: fixed;
            inset: 0;
            display: none;
            flex-direction: column;
        }

        /* HEADER */
        .header {
            height: 64px;
            padding: 0 20px;
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            padding-top: var(--safe-top);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .header-left, .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-center {
            flex: 1;
            text-align: center;
        }

        .header-title {
            font-size: 18px;
            font-weight: 700;
        }

        .icon-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: var(--bg-high);
            color: var(--text);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }

        .icon-btn:active {
            background: var(--bg-highest);
        }

        /* ADD FRIEND BUTTON - NEW */
        .add-friend-btn {
            position: fixed;
            bottom: 30px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 24px;
            box-shadow: 0 8px 32px rgba(0, 102, 255, 0.4);
            z-index: 90;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .add-friend-btn:active {
            transform: scale(0.9);
        }

        .add-friend-btn.pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 102, 255, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(0, 102, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 102, 255, 0); }
        }

        /* QUICK ADD MODAL - NEW */
        .quick-add-modal {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(20px);
        }

        .quick-add-modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .quick-add-card {
            background: var(--bg-elevated);
            border-radius: 20px;
            padding: 30px;
            width: 100%;
            max-width: 400px;
            transform: translateY(20px);
            animation: slideUp 0.3s ease forwards;
        }

        @keyframes slideUp {
            to { transform: translateY(0); }
        }

        .quick-add-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .quick-add-subtitle {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
            font-size: 15px;
        }

        /* ADD FRIEND METHODS - NEW */
        .add-methods {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .method-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 20px;
            background: var(--bg-high);
            border: none;
            border-radius: 16px;
            color: var(--text);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .method-btn:active {
            background: var(--bg-highest);
        }

        .method-icon {
            width: 44px;
            height: 44px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
        }

        .method-text {
            flex: 1;
            text-align: left;
        }

        .method-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        /* QR CODE SCANNER - NEW */
        .qr-scanner {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 1100;
            display: none;
            flex-direction: column;
        }

        .qr-scanner.active {
            display: flex;
        }

        .scanner-header {
            padding: 20px;
            background: var(--bg-elevated);
            border-bottom: 1px solid var(--border);
            text-align: center;
        }

        .scanner-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        .scanner-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .scanner-frame {
            width: 250px;
            height: 250px;
            border: 2px solid var(--primary);
            border-radius: 20px;
            position: relative;
        }

        .scanner-frame::before,
        .scanner-frame::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 4px solid var(--primary);
        }

        .scanner-frame::before {
            top: 0;
            left: 0;
            border-right: none;
            border-bottom: none;
            border-radius: 20px 0 0 0;
        }

        .scanner-frame::after {
            bottom: 0;
            right: 0;
            border-left: none;
            border-top: none;
            border-radius: 0 0 20px 0;
        }

        /* SIDEBAR */
        #sidebar {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 200;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        #sidebar.open {
            transform: translateX(0);
        }

        .sidebar-header {
            height: 64px;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding-top: var(--safe-top);
        }

        .profile {
            padding: 30px 20px;
            border-bottom: 1px solid var(--border);
        }

        .profile-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .avatar {
            width: 64px;
            height: 64px;
            background: var(--primary-gradient);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
        }

        .profile-text {
            flex: 1;
        }

        .profile-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .profile-status {
            font-size: 14px;
            color: var(--success);
        }

        /* NAVIGATION */
        .nav {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-btn {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px;
            background: var(--bg-high);
            border: none;
            color: var(--text);
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .nav-btn:active {
            background: var(--bg-highest);
        }

        .nav-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        /* CONTACTS LIST - IMPROVED */
        .contacts-section {
            padding: 20px;
        }

        .section-title {
            font-size: 14px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .contacts-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-high);
            border-radius: 12px;
            transition: all 0.2s;
        }

        .contact-item:active {
            background: var(--bg-highest);
        }

        .contact-avatar {
            width: 48px;
            height: 48px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
        }

        .contact-info {
            flex: 1;
        }

        .contact-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .contact-mutual {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .contact-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }

        .add-btn {
            background: var(--primary);
            color: white;
        }

        .chat-btn {
            background: var(--bg-highest);
            color: var(--text);
        }

        /* CHATS LIST */
        .chats-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            padding-bottom: 100px;
        }

        .chat-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border-radius: 16px;
            margin-bottom: 12px;
            background: var(--bg-high);
            transition: all 0.2s;
        }

        .chat-item:active {
            background: var(--bg-highest);
        }

        .chat-avatar {
            width: 52px;
            height: 52px;
            background: var(--primary);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: 600;
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .chat-name {
            font-weight: 600;
            font-size: 16px;
        }

        .chat-time {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .chat-preview {
            font-size: 14px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* FRIEND SUGGESTIONS - NEW */
        .suggestions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            padding: 20px;
        }

        .suggestion-card {
            background: var(--bg-high);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            transition: all 0.2s;
        }

        .suggestion-card:active {
            background: var(--bg-highest);
            transform: scale(0.98);
        }

        .suggestion-avatar {
            width: 64px;
            height: 64px;
            background: var(--primary);
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 700;
            margin: 0 auto 16px;
        }

        .suggestion-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .suggestion-mutual {
            font-size: 13px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .suggestion-add-btn {
            width: 100%;
            padding: 10px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
        }

        /* NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 30px;
            left: 20px;
            right: 20px;
            background: var(--bg-elevated);
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            transform: translateY(-100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* EMPTY STATE */
        .empty {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            text-align: center;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .empty-text {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 24px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .suggestions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-add-card {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- LOADING -->
    <div id="loading" class="flex flex-col items-center justify-center">
        <div class="loader"></div>
        <div style="margin-top: 20px; font-size: 24px; font-weight: 700; color: white;">Fluxio</div>
        <div style="margin-top: 8px; font-size: 16px; color: rgba(255,255,255,0.8);">Chargement...</div>
    </div>

    <!-- NOTIFICATIONS -->
    <div id="notifications"></div>

    <!-- AUTH -->
    <div id="auth">
        <div class="auth-container">
            <div class="app-brand">
                <div class="logo">‚ö°</div>
                <div class="app-title">Fluxio</div>
                <div class="app-subtitle">Ajoutez des amis en un clic</div>
            </div>
            
            <div class="auth-tabs">
                <button class="tab active" data-tab="login">Connexion</button>
                <button class="tab" data-tab="register">Inscription</button>
            </div>
            
            <form id="login-form" class="form">
                <input type="email" class="input" placeholder="Email" id="login-email" required>
                <input type="password" class="input" placeholder="Mot de passe" id="login-password" required>
                <button type="submit" class="btn">Se connecter</button>
            </form>
            
            <form id="register-form" class="form hidden">
                <input type="text" class="input" placeholder="Nom complet" id="register-name" required>
                <input type="email" class="input" placeholder="Email" id="register-email" required>
                <input type="password" class="input" placeholder="Mot de passe" id="register-password" required>
                <button type="submit" class="btn">Cr√©er un compte</button>
            </form>
        </div>
    </div>

    <!-- MAIN APP -->
    <div id="app" class="flex flex-col">
        <!-- HEADER -->
        <div class="header">
            <div class="header-left">
                <button class="icon-btn" onclick="toggleSidebar()">‚ò∞</button>
                <div class="header-center">
                    <div class="header-title" id="current-view">Messages</div>
                </div>
            </div>
            <div class="header-right">
                <button class="icon-btn" onclick="showAddFriendModal()">üë•</button>
                <button class="icon-btn" onclick="showModal('settings')">‚öô</button>
            </div>
        </div>

        <!-- ADD FRIEND FLOATING BUTTON -->
        <button class="add-friend-btn pulse" onclick="showAddFriendModal()">
            +
        </button>

        <!-- MAIN CONTENT -->
        <div class="flex-1">
            <!-- EMPTY STATE -->
            <div id="empty-state" class="empty">
                <div class="empty-icon">üë§</div>
                <div class="empty-title">Aucun ami</div>
                <div class="empty-text">Ajoutez des amis pour commencer √† discuter</div>
                <button class="btn" onclick="showAddFriendModal()" style="width: auto; padding: 0 32px;">
                    Ajouter un ami
                </button>
            </div>

            <!-- CHATS LIST -->
            <div id="chats-container" class="chats-list hidden">
                <!-- Chats loaded here -->
            </div>

            <!-- CONTACTS VIEW -->
            <div id="contacts-view" class="hidden">
                <div class="contacts-section">
                    <h3 class="section-title">Mes amis</h3>
                    <div class="contacts-list" id="friends-list">
                        <!-- Friends loaded here -->
                    </div>
                </div>
                
                <div class="contacts-section">
                    <h3 class="section-title">Suggestions</h3>
                    <div class="suggestions-grid" id="suggestions-list">
                        <!-- Suggestions loaded here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar">
        <div class="sidebar-header">
            <div style="font-size: 20px; font-weight: 700;">Menu</div>
            <button class="icon-btn" onclick="toggleSidebar()">‚úï</button>
        </div>
        
        <div class="profile">
            <div class="profile-info">
                <div class="avatar" id="user-avatar">U</div>
                <div class="profile-text">
                    <div class="profile-name" id="user-name">Utilisateur</div>
                    <div class="profile-status" id="user-status">üü¢ En ligne</div>
                </div>
            </div>
        </div>
        
        <div class="nav">
            <button class="nav-btn" onclick="showChats()">
                <span class="nav-icon">üí¨</span>
                Messages
            </button>
            <button class="nav-btn" onclick="showContacts()">
                <span class="nav-icon">üë•</span>
                Amis
            </button>
            <button class="nav-btn" onclick="showModal('settings')">
                <span class="nav-icon">‚öô</span>
                Param√®tres
            </button>
            <button class="nav-btn" onclick="showAddFriendModal()">
                <span class="nav-icon">‚ûï</span>
                Ajouter un ami
            </button>
        </div>
    </div>

    <!-- QUICK ADD MODAL -->
    <div class="quick-add-modal" id="add-friend-modal">
        <div class="quick-add-card">
            <h2 class="quick-add-title">Ajouter un ami</h2>
            <p class="quick-add-subtitle">Choisissez une m√©thode</p>
            
            <div class="add-methods">
                <button class="method-btn" onclick="searchByUsername()">
                    <div class="method-icon">üîç</div>
                    <div class="method-text">
                        Rechercher par nom
                        <div class="method-desc">Trouvez des amis par leur nom d'utilisateur</div>
                    </div>
                </button>
                
                <button class="method-btn" onclick="showQRScanner()">
                    <div class="method-icon">üì±</div>
                    <div class="method-text">
                        Scanner QR Code
                        <div class="method-desc">Scannez le code d'un ami</div>
                    </div>
                </button>
                
                <button class="method-btn" onclick="showPhoneContacts()">
                    <div class="method-icon">üìû</div>
                    <div class="method-text">
                        Contacts t√©l√©phone
                        <div class="method-desc">Trouvez des amis dans vos contacts</div>
                    </div>
                </button>
                
                <button class="method-btn" onclick="importFromSocial()">
                    <div class="method-icon">üåê</div>
                    <div class="method-text">
                        R√©seaux sociaux
                        <div class="method-desc">Importez depuis vos r√©seaux</div>
                    </div>
                </button>
                
                <button class="method-btn" onclick="showFriendSuggestions()">
                    <div class="method-icon">ü§ù</div>
                    <div class="method-text">
                        Suggestions
                        <div class="method-desc">Personnes que vous pourriez conna√Ætre</div>
                    </div>
                </button>
            </div>
            
            <button class="btn" style="margin-top: 24px;" onclick="hideAddFriendModal()">
                Annuler
            </button>
        </div>
    </div>

    <!-- SEARCH MODAL -->
    <div class="quick-add-modal" id="search-modal">
        <div class="quick-add-card">
            <h2 class="quick-add-title">Rechercher un ami</h2>
            
            <div style="margin-bottom: 24px;">
                <input type="text" 
                       class="input" 
                       id="username-search"
                       placeholder="Nom d'utilisateur ou email"
                       style="margin-bottom: 16px;">
                
                <div id="search-results">
                    <!-- Results appear here -->
                </div>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button class="btn" style="flex: 1; background: var(--bg-high);" onclick="hideSearchModal()">
                    Annuler
                </button>
                <button class="btn" style="flex: 1;" onclick="performSearch()">
                    Rechercher
                </button>
            </div>
        </div>
    </div>

    <!-- QR SCANNER -->
    <div class="qr-scanner" id="qr-scanner">
        <div class="scanner-header">
            <div style="font-size: 18px; font-weight: 600;">Scanner QR Code</div>
            <div style="font-size: 14px; color: var(--text-secondary); margin-top: 4px;">
                Pointez la cam√©ra vers le code
            </div>
        </div>
        
        <div class="scanner-viewport">
            <div class="scanner-overlay">
                <div class="scanner-frame"></div>
            </div>
        </div>
        
        <div style="padding: 20px;">
            <button class="btn" onclick="hideQRScanner()">
                Annuler
            </button>
        </div>
    </div>

    <!-- FRIEND REQUEST MODAL -->
    <div class="quick-add-modal" id="friend-request-modal">
        <div class="quick-add-card">
            <div style="text-align: center; margin-bottom: 24px;">
                <div class="avatar" id="request-avatar" style="width: 80px; height: 80px; margin: 0 auto 20px;">J</div>
                <h2 class="quick-add-title" id="request-name">Jean Dupont</h2>
                <p class="quick-add-subtitle" id="request-mutual">5 amis en commun</p>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button class="btn" style="flex: 1; background: var(--bg-high);" onclick="declineRequest()">
                    Refuser
                </button>
                <button class="btn" style="flex: 1;" onclick="acceptRequest()">
                    Accepter
                </button>
            </div>
        </div>
    </div>

    <script>
        // APPLICATION STATE
        const App = {
            // State
            user: null,
            friends: new Map(),
            friendRequests: new Map(),
            pendingRequests: new Map(),
            suggestions: new Map(),
            chats: new Map(),
            currentView: 'chats',
            
            // Initialize
            init() {
                this.setupEventListeners();
                this.loadData();
                this.checkAuth();
                
                // Generate demo data if empty
                if (this.friends.size === 0) {
                    this.generateDemoSuggestions();
                }
            },
            
            // Authentication
            checkAuth() {
                const session = localStorage.getItem('fluxio_session');
                if (session) {
                    try {
                        const { userId } = JSON.parse(session);
                        const userData = localStorage.getItem(`fluxio_user_${userId}`);
                        
                        if (userData) {
                            this.user = JSON.parse(userData);
                            this.showApp();
                            return;
                        }
                    } catch (e) {}
                }
                this.showAuth();
            },
            
            login(email, password) {
                // Simulate authentication
                const users = JSON.parse(localStorage.getItem('fluxio_users') || '[]');
                const user = users.find(u => u.email === email && u.password === password);
                
                if (!user) {
                    this.showNotification('Identifiants incorrects', 'error');
                    return false;
                }
                
                this.user = user;
                localStorage.setItem('fluxio_session', JSON.stringify({
                    userId: user.id,
                    timestamp: Date.now()
                }));
                
                this.showApp();
                this.showNotification('Connect√© avec succ√®s');
                return true;
            },
            
            register(name, email, password) {
                const users = JSON.parse(localStorage.getItem('fluxio_users') || '[]');
                
                if (users.some(u => u.email === email)) {
                    this.showNotification('Cet email est d√©j√† utilis√©', 'error');
                    return false;
                }
                
                const user = {
                    id: 'u' + Date.now(),
                    name,
                    email,
                    password,
                    avatarColor: this.getRandomColor(),
                    createdAt: Date.now(),
                    friends: [],
                    friendRequests: []
                };
                
                users.push(user);
                localStorage.setItem('fluxio_users', JSON.stringify(users));
                this.user = user;
                
                localStorage.setItem('fluxio_session', JSON.stringify({
                    userId: user.id,
                    timestamp: Date.now()
                }));
                
                this.showApp();
                this.showNotification('Compte cr√©√© avec succ√®s');
                return true;
            },
            
            // Data Management
            loadData() {
                try {
                    // Load friends
                    const savedFriends = localStorage.getItem(`fluxio_friends_${this.user?.id}`);
                    if (savedFriends) {
                        JSON.parse(savedFriends).forEach(f => {
                            this.friends.set(f.id, f);
                        });
                    }
                    
                    // Load suggestions
                    const savedSuggestions = localStorage.getItem('fluxio_suggestions');
                    if (savedSuggestions) {
                        JSON.parse(savedSuggestions).forEach(s => {
                            this.suggestions.set(s.id, s);
                        });
                    }
                } catch (e) {
                    console.log('Erreur chargement donn√©es');
                }
            },
            
            saveData() {
                try {
                    if (this.user) {
                        localStorage.setItem(`fluxio_friends_${this.user.id}`, 
                            JSON.stringify(Array.from(this.friends.values())));
                        localStorage.setItem('fluxio_suggestions',
                            JSON.stringify(Array.from(this.suggestions.values())));
                        localStorage.setItem(`fluxio_user_${this.user.id}`, 
                            JSON.stringify(this.user));
                    }
                } catch (e) {
                    console.log('Erreur sauvegarde');
                }
            },
            
            // UI Methods
            showAuth() {
                setTimeout(() => {
                    $('#loading').classList.add('hidden');
                    $('#auth').style.display = 'block';
                }, 500);
            },
            
            showApp() {
                setTimeout(() => {
                    $('#loading').classList.add('hidden');
                    $('#app').style.display = 'flex';
                    this.updateUserInfo();
                    this.loadFriends();
                    this.loadSuggestions();
                    this.showNotification('Bienvenue sur Fluxio');
                }, 500);
            },
            
            updateUserInfo() {
                if (!this.user) return;
                
                $('#user-name').textContent = this.user.name;
                $('#user-avatar').textContent = this.user.name.charAt(0).toUpperCase();
                $('#user-avatar').style.background = this.user.avatarColor;
            },
            
            // Friend Management - SIMPLIFIED
            async searchFriend(query) {
                if (!query.trim()) {
                    this.showNotification('Entrez un nom', 'error');
                    return;
                }
                
                // Show loading
                const resultsDiv = $('#search-results');
                resultsDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Recherche en cours...</div>';
                
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 800));
                
                // Generate mock results
                const mockResults = this.generateMockResults(query);
                
                if (mockResults.length === 0) {
                    resultsDiv.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üë§</div>
                            <div style="color: var(--text-secondary);">Aucun r√©sultat trouv√©</div>
                        </div>
                    `;
                    return;
                }
                
                // Display results
                resultsDiv.innerHTML = mockResults.map(user => `
                    <div class="contact-item" style="margin-bottom: 12px;">
                        <div class="contact-avatar" style="background: ${user.color}">
                            ${user.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="contact-info">
                            <div class="contact-name">${user.name}</div>
                            <div class="contact-mutual">${user.mutualFriends} amis en commun</div>
                        </div>
                        <button class="add-btn action-btn" onclick="App.sendFriendRequest('${user.id}')">
                            +
                        </button>
                    </div>
                `).join('');
            },
            
            sendFriendRequest(friendId) {
                const friend = this.suggestions.get(friendId) || this.generateMockUser(friendId);
                
                if (!friend) {
                    this.showNotification('Utilisateur non trouv√©', 'error');
                    return;
                }
                
                // Add to pending requests
                this.pendingRequests.set(friendId, {
                    ...friend,
                    timestamp: Date.now(),
                    status: 'pending'
                });
                
                this.showNotification(`Demande envoy√©e √† ${friend.name}`);
                this.hideSearchModal();
                
                // Simulate auto-accept for demo
                setTimeout(() => {
                    this.acceptFriendRequest(friendId);
                }, 2000 + Math.random() * 3000);
            },
            
            acceptFriendRequest(friendId) {
                const request = this.pendingRequests.get(friendId);
                if (!request) return;
                
                // Add to friends
                this.friends.set(friendId, {
                    ...request,
                    status: 'accepted',
                    friendsSince: Date.now()
                });
                
                // Remove from suggestions and pending
                this.suggestions.delete(friendId);
                this.pendingRequests.delete(friendId);
                
                this.showNotification(`${request.name} est maintenant votre ami`);
                this.loadFriends();
                this.loadSuggestions();
                this.saveData();
            },
            
            declineFriendRequest(friendId) {
                const request = this.pendingRequests.get(friendId);
                if (!request) return;
                
                this.pendingRequests.delete(friendId);
                this.showNotification(`Demande refus√©e`);
                this.hideFriendRequestModal();
            },
            
            // UI Rendering
            loadFriends() {
                const container = $('#friends-list');
                
                if (this.friends.size === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 40px 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üë•</div>
                            <div style="color: var(--text-secondary);">Ajoutez votre premier ami</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = Array.from(this.friends.values()).map(friend => `
                    <div class="contact-item">
                        <div class="contact-avatar" style="background: ${friend.color || friend.avatarColor}">
                            ${friend.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="contact-info">
                            <div class="contact-name">${friend.name}</div>
                            <div class="contact-mutual">Ami depuis ${this.formatTime(friend.friendsSince)}</div>
                        </div>
                        <div class="contact-actions">
                            <button class="chat-btn action-btn" onclick="App.startChat('${friend.id}')">
                                üí¨
                            </button>
                        </div>
                    </div>
                `).join('');
            },
            
            loadSuggestions() {
                const container = $('#suggestions-list');
                
                if (this.suggestions.size === 0) {
                    container.innerHTML = `
                        <div style="grid-column: 1/-1; text-align: center; padding: 40px 20px;">
                            <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">ü§ù</div>
                            <div style="color: var(--text-secondary);">Aucune suggestion pour le moment</div>
                        </div>
                    `;
                    return;
                }
                
                container.innerHTML = Array.from(this.suggestions.values()).map(suggestion => `
                    <div class="suggestion-card" onclick="App.showFriendRequest('${suggestion.id}')">
                        <div class="suggestion-avatar" style="background: ${suggestion.color}">
                            ${suggestion.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="suggestion-name">${suggestion.name}</div>
                        <div class="suggestion-mutual">${suggestion.mutualFriends} amis en commun</div>
                        <button class="suggestion-add-btn" onclick="event.stopPropagation(); App.sendFriendRequest('${suggestion.id}')">
                            Ajouter
                        </button>
                    </div>
                `).join('');
            },
            
            // Helper Methods
            formatTime(timestamp) {
                const now = Date.now();
                const diff = now - timestamp;
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (days === 0) return "aujourd'hui";
                if (days === 1) return "hier";
                if (days < 7) return `il y a ${days} jours`;
                if (days < 30) return `il y a ${Math.floor(days/7)} semaines`;
                return `il y a ${Math.floor(days/30)} mois`;
            },
            
            getRandomColor() {
                const colors = ['#0066FF', '#FF3366', '#00C853', '#FFAA00', '#9966FF'];
                return colors[Math.floor(Math.random() * colors.length)];
            },
            
            // Demo Data Generation
            generateDemoSuggestions() {
                const names = [
                    'Jean Dupont', 'Marie Martin', 'Pierre Bernard', 'Sophie Petit',
                    'Thomas Richard', 'Julie Dubois', 'Michelle Robert', 'David Moreau',
                    'Emma Simon', 'Paul Laurent', 'Chlo√© Michel', 'Lucas Lefebvre'
                ];
                
                names.forEach((name, index) => {
                    const suggestion = {
                        id: 's' + index,
                        name: name,
                        color: this.getRandomColor(),
                        mutualFriends: Math.floor(Math.random() * 10) + 1,
                        interests: ['Sport', 'Musique', 'Voyage', 'Cin√©ma', 'Technologie'][Math.floor(Math.random() * 5)],
                        location: ['Paris', 'Lyon', 'Marseille', 'Toulouse', 'Bordeaux'][Math.floor(Math.random() * 5)]
                    };
                    this.suggestions.set(suggestion.id, suggestion);
                });
                
                this.saveData();
            },
            
            generateMockResults(query) {
                const mockUsers = [];
                const nameParts = query.toLowerCase().split(' ');
                
                // Check suggestions first
                this.suggestions.forEach(user => {
                    if (user.name.toLowerCase().includes(query.toLowerCase())) {
                        mockUsers.push(user);
                    }
                });
                
                // Add some random mock users if needed
                if (mockUsers.length < 3) {
                    const extraNames = ['Alexandre', 'Camille', 'Nicolas', 'Sarah', 'Kevin', 'Laura'];
                    extraNames.forEach((name, i) => {
                        if (mockUsers.length < 5) {
                            mockUsers.push({
                                id: 'mock' + i,
                                name: name + ' ' + ['Durand', 'Lemoine', 'Garcia', 'Fournier'][i % 4],
                                color: this.getRandomColor(),
                                mutualFriends: Math.floor(Math.random() * 8),
                                interests: ['Art', 'Lecture', 'Cuisine', 'Photographie'][i % 4]
                            });
                        }
                    });
                }
                
                return mockUsers;
            },
            
            generateMockUser(id) {
                const names = ['Alexandre', 'Camille', 'Nicolas', 'Sarah', 'Kevin', 'Laura'];
                return {
                    id,
                    name: names[Math.floor(Math.random() * names.length)] + ' ' + ['Durand', 'Lemoine', 'Garcia'][Math.floor(Math.random() * 3)],
                    color: this.getRandomColor(),
                    mutualFriends: Math.floor(Math.random() * 6) + 1
                };
            },
            
            // UI Controls
            showFriendRequest(friendId) {
                const friend = this.suggestions.get(friendId) || this.generateMockUser(friendId);
                if (!friend) return;
                
                $('#request-name').textContent = friend.name;
                $('#request-avatar').textContent = friend.name.charAt(0).toUpperCase();
                $('#request-avatar').style.background = friend.color;
                $('#request-mutual').textContent = `${friend.mutualFriends} amis en commun`;
                
                // Store current friend ID
                $('#friend-request-modal').dataset.friendId = friendId;
                showModal('friend-request');
            },
            
            startChat(friendId) {
                const friend = this.friends.get(friendId);
                if (!friend) return;
                
                this.showNotification(`Discussion d√©marr√©e avec ${friend.name}`);
                // In a real app, this would open a chat window
            },
            
            showNotification(message, type = '') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;
                
                $('#notifications').appendChild(notification);
                
                setTimeout(() => notification.classList.add('show'), 10);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => notification.remove(), 300);
                }, 3000);
            },
            
            vibrate() {
                if (navigator.vibrate) {
                    navigator.vibrate(30);
                }
            },
            
            // Event Listeners
            setupEventListeners() {
                // Auth forms
                $('#login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const email = $('#login-email').value.trim();
                    const password = $('#login-password').value.trim();
                    this.login(email, password);
                });
                
                $('#register-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const name = $('#register-name').value.trim();
                    const email = $('#register-email').value.trim();
                    const password = $('#register-password').value.trim();
                    this.register(name, email, password);
                });
                
                // Auth tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        const tabName = tab.dataset.tab;
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        tab.classList.add('active');
                        
                        $('#login-form').classList.toggle('hidden', tabName !== 'login');
                        $('#register-form').classList.toggle('hidden', tabName !== 'register');
                    });
                });
                
                // Search input
                $('#username-search').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        this.performSearch();
                    }
                });
            }
        };

        // DOM Helper
        const $ = (id) => document.getElementById(id);

        // Initialize App
        window.addEventListener('DOMContentLoaded', () => {
            App.init();
        });

        // Global Functions
        window.toggleSidebar = function() {
            $('#sidebar').classList.toggle('open');
        };

        window.showAddFriendModal = function() {
            $('#add-friend-modal').classList.add('active');
        };

        window.hideAddFriendModal = function() {
            $('#add-friend-modal').classList.remove('active');
        };

        window.showSearchModal = function() {
            hideAddFriendModal();
            $('#search-modal').classList.add('active');
            $('#username-search').focus();
        };

        window.hideSearchModal = function() {
            $('#search-modal').classList.remove('active');
        };

        window.performSearch = function() {
            const query = $('#username-search').value.trim();
            App.searchFriend(query);
        };

        window.showQRScanner = function() {
            hideAddFriendModal();
            $('#qr-scanner').classList.add('active');
            
            // Simulate QR scanning
            setTimeout(() => {
                hideQRScanner();
                App.showNotification('QR Code scann√© avec succ√®s');
                App.sendFriendRequest('qr' + Date.now());
            }, 1500);
        };

        window.hideQRScanner = function() {
            $('#qr-scanner').classList.remove('active');
        };

        window.showPhoneContacts = function() {
            hideAddFriendModal();
            App.showNotification('Importation des contacts...');
            
            // Simulate contact import
            setTimeout(() => {
                App.showNotification('3 amis trouv√©s dans vos contacts');
                // Add mock friends from contacts
                for (let i = 0; i < 3; i++) {
                    App.sendFriendRequest('contact' + i);
                }
            }, 1000);
        };

        window.importFromSocial = function() {
            hideAddFriendModal();
            App.showNotification('Connexion aux r√©seaux sociaux...');
            
            setTimeout(() => {
                App.showNotification('5 amis import√©s depuis vos r√©seaux');
                for (let i = 0; i < 5; i++) {
                    App.sendFriendRequest('social' + i);
                }
            }, 1000);
        };

        window.showFriendSuggestions = function() {
            hideAddFriendModal();
            showContacts();
            App.showNotification('Suggestions d\'amis charg√©es');
        };

        window.showModal = function(modalId) {
            $(`${modalId}-modal`).classList.add('active');
        };

        window.hideModal = function(modalId) {
            $(`${modalId}-modal`).classList.remove('active');
        };

        window.acceptRequest = function() {
            const friendId = $('#friend-request-modal').dataset.friendId;
            if (friendId) {
                App.acceptFriendRequest(friendId);
            }
            hideModal('friend-request');
        };

        window.declineRequest = function() {
            const friendId = $('#friend-request-modal').dataset.friendId;
            if (friendId) {
                App.declineFriendRequest(friendId);
            }
            hideModal('friend-request');
        };

        window.showChats = function() {
            App.currentView = 'chats';
            $('#current-view').textContent = 'Messages';
            $('#contacts-view').classList.add('hidden');
            $('#empty-state').classList.add('hidden');
            $('#chats-container').classList.remove('hidden');
            toggleSidebar();
        };

        window.showContacts = function() {
            App.currentView = 'contacts';
            $('#current-view').textContent = 'Amis';
            $('#chats-container').classList.add('hidden');
            $('#empty-state').classList.add('hidden');
            $('#contacts-view').classList.remove('hidden');
            App.loadFriends();
            App.loadSuggestions();
            toggleSidebar();
        };

        window.searchByUsername = function() {
            hideAddFriendModal();
            showSearchModal();
        };

        // Expose App globally
        window.App = App;
    </script>
</body>
</html>
